# Документация сервиса: Оценка риска сердечного приступа

## 1. Общее описание

Веб-сервис предназначен для оценки риска сердечного приступа на основе восьми медицинских признаков, вводимых пользователем через HTML-форму. В процессе подготовки сервиса было проведено исследование медицинских данных: выполнен анализ распределений, корреляций и важности признаков, построен пайплайн и обучена модель KNN с подбором гиперпараметров и использованием SMOTE. Несмотря на низкую информативность отдельных признаков, модель продемонстрировала умеренное качество (ROC-AUC до 0.59) и опередила случайный классификатор. Финальная модель сохранена в model.pkl и используется для инференса через веб-интерфейс. Архитектура реализована на FastAPI и включает логирование, валидацию и веб-интерфейс.

## 2. Технологии

- Язык программирования: Python 3.11
- Фреймворк: FastAPI
- Сервер: Uvicorn
- Машинное обучение: scikit-learn, joblib
- Веб-интерфейс: HTML, Jinja2
- Дополнительно: pandas, logging

## 3. Структура проекта

- `main.py` — основной скрипт API-приложения
- `model.pkl` — обученная модель
- `templates/form.html` — HTML-форма ввода признаков
- `requirements.txt` — зависимости проекта
- `notebooks/heart.ipynb` — ноутбук c исследованием и обучением модели

## 4. Установка и запуск

### Клонирование репозитория

```bash
git clone <URL_репозитория>
cd <имя_папки_проекта>
```

### Требования

- Python 3.11+
- Установленные зависимости из `requirements.txt`

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Запуск приложения

```bash
python main.py
```

Приложение будет доступно по адресу: `http://127.0.0.1:8000`

### Завершение работы приложения

Если порт занят или требуется перезапуск:

```bash
pkill -f uvicorn
```

## 5. Эндпоинты

- `GET /` — отрисовка HTML-формы
- `POST /predict` — приём данных формы и возврат результата предсказания
- `GET /health` — проверка статуса API

## 6. Описание входных данных

### Формат формы

Форма принимает следующие поля:

- `systolic_blood_pressure`: float
- `bmi`: float
- `heart_rate`: float
- `previous_heart_problems`: int (0 или 1)
- `cholesterol`: float
- `diet`: int (0, 1 или 2)
- `triglycerides`: float
- `stress_level`: int (от 1 до 10)

**Ограничения ввода уже предусмотрены в самой HTML-форме**.

### Пример CSV

```csv
systolic_blood_pressure,bmi,heart_rate,previous_heart_problems,cholesterol,diet,triglycerides,stress_level
0.3,0.55,0.06,0,0.67,1,0.42,7
```

## 7. Описание выходных данных

- Формат ответа: HTML-страница с отображением результата
- Значения:
  - `High risk (1)` — высокий риск сердечного приступа
  - `Low risk (0)` — низкий риск

## 8. Обработка ошибок

- Код `200 OK` — успешный ответ
- Код `422 Unprocessable Entity` — некорректные или неполные данные
- Код `500 Internal Server Error` — ошибка предсказания или загрузки модели

Сообщения об ошибках логируются в файл `app.log`.

## 9. Логирование

- Логи сохраняются в файл `app.log`
- Формат логов: `[дата время] [уровень] сообщение`
- Логируются:
  - Успешная загрузка модели
  - Входные данные
  - Результаты предсказаний
  - Ошибки выполнения

## 10. Тестирование

Для локального тестирования используется браузер. Также можно использовать `curl`:

```bash
curl http://127.0.0.1:8000/health
```

## 11. Будущие улучшения

- Упаковка в Docker
- Добавление базы данных для хранения истории предсказаний